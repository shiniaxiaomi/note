[TOC]

# 介绍

在非mac电脑上安装mac系统,就被称为黑苹果,黑苹果要解决很多硬件兼容带来的问题

# 黑苹果的历史

在2005年,苹果将系统架构转向了Intel的x86结构,才使得现在可以在普通电脑上安装mac成为可能

第一代版本采用了更换定制内核的方法,第二代是由某个黑客写了一个名为 chameleon的bootloader，国内大家称呼为“变色龙” ,这是第一个广泛性的引导器; 第三代出现了新的引导方法: Clover Bootloader,即四叶草; 它支持UEFI启动,相较于Chameleon功能更加强大,适配更加完美; 

# 评定黑苹果的稳定

一台完美的黑苹果主要包括以下几个方面: CPU,显卡,声卡,网卡,蓝牙,电源管理,USB,睡眠,散热;

1. CPU: 一般的CPU基本上都没有问题
2. 显卡: 一般只能使用集成显卡, 但是如果你是AMD的显卡,基本上可以驱动
3. 声卡: 是否正常
4. 网卡: 能够正常稳定的上网
5. 蓝牙: 能够驱动蓝牙
6. 电源管理: 远程CPU电源管理,变频等等
7. USB: 能够驱动USB
8. 睡眠: 一般在笔记本上需求较多,能够正常睡眠
9. 散热: 能够驱动风扇进行良好的散热

# 黑苹果原理

电脑系统的启动需要两个东西一起应用

1. 一个是Bootloader,就是启动器
2. 一个是兼容这个启动器的操作系统

启动器就是唤醒操作系统的一个小系统,它被烧录在主板ROM上,目前的通用启动器由BIOS和UEFI,苹果的引导方法是用自己定制的EFI搭配各种软件引导进入macOS的,但是EFI是UEFI的前身,UEFI在其基础上再做了修改,但是普通的UEFI还是无法引导macOS,因为不仅仅是不兼容,而且无法提供各类macOS启动需要的数据和验证

从黑苹果的历史可知,黑苹果的方法无非就两种:

1. 替换内核,非常的繁琐
2. 使用启动器

所以,我们现在的安装黑苹果的方式基本上都是使用第二种方式:使用启动器

大神开发出第三方的启动器,让UEFI先启动这个第三方的启动器,然后第三方的启动器在引导macOS,并且在启动过程中提供各类参数,数据和跳过验证等

目前最主流的是UEFI+Clover的方式:

- 使用UEFI+Clover方式引导macOS实际上是每次主板启动,都会引导硬盘EFI分区中的Clover,然后再由定制的Clover来引导macOS,Clover的功能非常强大,可以加载各种定制EFI文件
- 我们可以把Clover理解为一个安装在硬盘上的Bootloader

# 黑苹果安装大致流程

首先,我们需要利用macOS镜像制作一个macOS安装U盘,接着我们需要在U盘的EFI分区中安装Clover引导,这样我们在电脑中插入U盘时,UEFI就会引导U盘的EFI分区的Clover,我们再借助Clover进入macOS安装环境

其中最大的难点就在于如何配置Clover引导([Clover 配置详解](https://www.jianshu.com/p/b156b0177a24)),Clover配置选项繁多,功能定义不清晰,总之,只要我们能设置好Clover引导,我们就能顺利进入macOS安装界面,一步步安装macOS即可;

> 所以,如果我们能拿到你电脑配置对应的安装成功案例的Clover,那么你只要复制其Clover,那么你也可以快速的安装成功(只要配置类似,基本也能顺利安装);因此,你会在论坛上进场看到有人伸手要EFI(其中包含了Clover)

在安装完macOS后,我们需要把U盘的Clover文件放到硬盘的EFI分区中,之后我们直接让UEFI启动硬盘的EFI分区中的Clover,Clover在引导macOS启动,那么就无需U盘了;

在装完macOS系统后,会出现我们的部分硬件不能够很好的被macOS所驱动,如网卡,显卡,USB,蓝牙等等,这是我们就需要安装对应的驱动来使得我们的硬件工作;往往这一步才是非常的痛苦,也非常考验黑苹果的功底;

# Clover启动器

## Clover兼EFI的目录结构

![EFI](D:\note\.img\EFI.png)

## Clover使用教程

[具体参考教程](https://www.i5seo.com/the-past-and-present-of-clover-and-the-tutorial-of-using-clover.html)

# 黑苹果硬件兼容性总结

[基本硬件兼容参考](https://post.m.smzdm.com/p/a78emold/)

[网卡和蓝牙](https://post.m.smzdm.com/p/a83d937n/)

[搭建高配置的黑苹果](https://post.m.smzdm.com/p/a07mnz0w/)

# 记录

WIFI模块: BCM94360(最好能够集成蓝牙的)

## 制作启动盘

TransMac: 制作mac安装盘

- 打开软件,找到自己对应的U盘,右键选择`Format Disk for Mac`,并进行重命名为`Mac OS`,点击OK,之后就会对U盘进行格式化
- 格式化完成后,还是在软件中找到对应的U盘,右键选择`Restore with Disk Image`,进行写入Mac OS镜像文件文件; 我们选择好下载的Mac OS镜像后,点击OK,那么软件就会开始往U盘中写入镜像文件,过程比较漫长,需要等待一会儿; 镜像写入完成之后,软件会弹窗问你是否需要格式化该U盘,选择`否`即可

DiskGenius: 分区软件 

- 打开软件,通过该软件将写入U盘中的镜像的EFI文件替换即可

  如果你使用了已经替换过的镜像文件,那么你就无需再替换了

## 开始安装Mac OS

- 将你要安装的硬盘进行删除卷

  - 如果要安装双系统,则点击删除卷,然后不要再添加卷,但是不要进行格式化

- 重启电脑,按F12进入BIOS设置,将电脑启动项设置为U盘启动,按F10保存后重启电脑

- 重启电脑后会进入到Clover模式,选择Mac OS系统,按一下空格,进行设置,将`Verbose(-v)`模式打开,这样在安装系统时会显示详细的安装系统,当你安装时卡住也可以手机拍照到论坛进行问题排查(如果超过15分钟不动,那么就需要进行拍照排查了)

- 进入到安装界面之后,首先选择`磁盘工具`,然后选择`显示所有设备`,选择我们需要安装Mac OS的对应的硬盘,点击`抹掉`,这时我们要给这个硬盘起一个名字,那么我取名为Mac OS,并且格式要选择`Mac OS 扩展 (日志式)`,如下图所示:

  ![1572359085742](D:\note\.img\1572359085742.png)

  抹掉完成后,我们就可以把磁盘工具关掉,然后选择第二项:`安装Mac OS`,接下来一路next,之后我们需要选择我们刚才起好名字要安装系统的硬盘,然后点击安装,安装完之后会进入第一次重启

- 重启完电脑后,我们会看到如下图所示:

  ![1572359271491](D:\note\.img\1572359271491.png)

  这时,我们需要选择左侧的图标,然后按一下空格,勾选`Verbose(-V)`选项,然后回退后回车进行安装,安装过程大约在10分钟左右,安装完成之后会进入第二次重启

- 第二次重启后,会看到以下界面:

  ![1572359532395](D:\note\.img\1572359532395.png)

  这时我们需要选择第二个,按一下空格,勾选`Verbose(-V)`选项,然后回退后回车进行安装,安装完成之后就会进入到苹果的系统设置界面

  > 在系统设置时先不要进行联网

  一路next,并创建好电脑账号

## 驱动安装及引导

1. 让计算机脱离U盘的引导启动

   

2. 安装系统对应的硬件驱动



# 学习参考

## 教程参考

悦享教程:

- [图文教程](https://www.yuexiang.fun/1153.html)
- [配套的视频教程](https://www.bilibili.com/video/av58248756)

什么值得买:

- [一些帖子挺不错](https://post.m.smzdm.com/fenlei/bangongruanjian/brand-1687/)

mac镜像: 

- [下载地址](https://mirrors.dtops.cc/iso/MacOS/daliansky_macos/10.13/)(已经尝试)
-  或者下载macOS Mojave镜像: [【黑果小兵】macOS Mojave 10.14.3 18D42 正式版 with Clover 4859原版镜像](https://blog.daliansky.net/macOS-Mojave-10.14.3-18D42-official-version-with-Clover-4859-original-image.html) 

## 知识获取

- [tonymacx86.com](http://www.tonymacx86.com/)：这是国外的一个黑苹果论坛 ,  首推论坛 

  包含了采购指南:  适合没有配置的情况下想配一台黑苹果专用主机的人 

  包含了安装指南:

- [Github](http://www.github.com/)：Github也是一个非常好的黑果资源搜索器，首先大部分的Kexts开发者都把库放到了这里 

- [远景论坛](http://bbs.pcbeta.com/)：算是国内最大的黑苹果论坛 

- [B站](http://search.bilibili.com/all?keyword=黑苹果): 很多视频教程

- 诸多个人论坛:  国光、黑果小兵、nickwoodhams 等

# 参考文档

[**黑果小兵的部落阁**](https://blog.daliansky.net/) 

[**黑苹果社区**](https://osx.cx/tag/%E9%BB%91%E8%8B%B9%E6%9E%9C/)