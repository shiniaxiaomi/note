[TOC]

# 整体概述

介绍：将需要检索的内容保存在内存中，并通过合理的索引，快速的检索内容

## 数据输入：文档和索引

Elasticsearch是一个分布式文档存储，替换传统的关系型数据库，Elasticsearch可以存储复杂的数据结构例如序列化后的json数据。当部署了Elasticsearch集群时，文档将被存在多个节点中，并且当查询数据时可以很快的从多个节点中查询并汇总结果



当文档被存储时，Elacticsearch会自动的文档建立索引，并且能够在1s之内就可以查询到建立索引后的数据。



Elasticsearch使用了反向索引来提供快速的全文检索。反向索引记录了出现在任何文档中的唯一单词和标识每个单词出现在哪些文档中



一个索引可以被看作是多个文档的一个优化过的集合，每个文档是字段的集合，字段是包含数据的key-value的键值对。Elasticsearch默认在每个字段中索引所有数据，并且每个索引字段都有一个专用的、优化的数据结构。例如，文本字段将被存储在反向索引中，数字和地理字段将被存储在BKD树中。组装不同类型的索引并返回查询结果的能力才使得Elasticsearch这么快。



Elasticsearch可以对文档进行自动索引，而无需显式的指定如何处理文档中可能出现的每个不同的字段。当动态映射开启是，Elasticsearch会自动检查和添加新字段到索引中。这项默认的行为使得索引和查询数据更加的简单。只要开始索引文档，Elasticsearch就会检测和映射字段类型：如布尔值、浮点、整数、日期和字符串

> 官方建议最好是我们自己定义好索引规则

自定映射能够有以下好处：

- 区分文本字符串和数值字符串
- 执行特定语法的文本分析
- 为部分匹配优化字段
- 使用自定义日期格式
- 使用无法自动检测的数据类型

为不同的目的为相同的字段建立不同的索引通常是有用的。

## 信息输出：查询和分析

我们之所以能够使用Elasticsearch很方便的存储和检索文档时，这得益于Elasticsearch使用了Apache的Lucene查询引擎库



Elasticsearch提供了简单，清晰的REST API来管理集群、索引和查询数据

### 查询数据

Elasticsearch的REST API支持结构化查询、全文查询和复杂的查询。

- 结构化查询就像使用sql一样。举个例子，你可以查询`gender`字段和`age`字段在`emplyee`索引中，并且可以将匹配到的数据按照`hire_date`字段排序。
- 全文查询可以根据查询关键字查询全部文档，并按照匹配度排序返回结果

除了搜索单独的关键字，还可以进行短语搜索、相似度搜索和前缀搜索

Elasticsearch还为非文本数据如数字提供了优化的数据结构将其索引，提供高性能的检索



Elasticsearch提供了全面的json风格的查询语言（DSL）来搜索数据。或者使用SQL风格查询，以便在搜索和聚合数据

### 分析数据

Elasticsearch聚合能够让我们根据数据构建复杂的总结和深入了解关键的指标、模式和趋势。聚合后的数据能够回答以下问题：

- 总共有多少数据？
- 数据的平均长度是多少？
- 按制造商分类后的数据的长度中间值是多少？
- 在过去的6个月中，每个月总共有多少数据被添加？

聚合使用了搜索的数据结构，这是的我们使用聚合来分析数据时基本上是实时的。Elasticsearch允许我们可以在一个请求中同时进行搜索文档、过滤结果和进行聚合分析。

## 可伸缩性和弹性：集群、节点和碎片

Elasticsearch自动的分发数据到每个节点，并且可以从每个节点搜索数据并汇总结果返回，Elasticsearch知道如何平衡多节点集群以提供可伸缩性和高可用性



它是如何工作的？Elasticsearch只是合理的组织一个或多个物理碎片，每个碎片实际上是一个独立的索引。将文档分布在多个碎片中，多个碎片分布在多个节点中，Elasticsearch可以确保没有冗余，并且可以防止硬件损坏和增加查询能力当节点添加到集群后。当集群增大或缩小，Elasticsearch可以自动的移动节点来重新调整集群。



这里有两种类型的碎片：主碎片和碎片副本。索引中的每个文档都属于主碎片。一个碎片副本是从主碎片拷贝的。碎片副本是为了预防硬件损坏导致数据丢失和增加服务器读请求（如搜索或检索文档）的能力



索引中的主碎片数量在索引被创建的时候是固定的，但是碎片副本的数量可以在任何时候被改变，并且不会中断索引或查询操作

### 视情况而定

有一些性能考虑和权衡：考虑碎片大小，为索引配置的主碎片的数量。碎片个数越多，维护索引的开销越大。碎片体积越大，Elasticsearch移动碎片来重新调整集群所消耗的时间越久



查询大量小碎片，每个小碎片相对于大碎片来说处理速度更快， 但是更多查询意味着更多开销，所以查询总量相同的情况下，少量的查询大碎片相比于更多的查询小碎片的开销更小，当然，这只是相对来说

### 如果发生灾难

高可用架构避免了把鸡蛋都放在同一个篮子里。当主集群出现问题而停止提供服务，那么另外一个备用集群会替代主集群被提供服务，即Cross-cluster replication (CCR)



CCR提供一种方式来自动的将主集群中的索引同步到其他集群中，以供来提供服务以处理更多的请求（热备份）。如果主集群宕机了，那么其他集群将取而代之。其他集群中的索引是只读的，索引只能从主集群中同步过来。

### 维护和保养

在企业级系统中，需要工具去保护、管理、监控Elasticsearch集群，官方推荐使用[Kibana](https://www.elastic.co/guide/en/kibana/7.4/introduction.html)来进行管理集群

# 入门

https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html



# 参考文档

[官方文档](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro.html)

[Elasticsearch入门的整体概述](https://blog.csdn.net/achuo/article/details/87865141)

[ElasticSearch的索引原理分析](https://blog.csdn.net/qq_38262266/article/details/90311086)

[Elasticsearch的快速使用](https://www.cnblogs.com/cjsblog/p/9439331.html)

